MODULE Log; (*jr 22.5.2024*)
  PROCEDURE ln*(x: REAL): REAL;
    (* ln(x) = 2*arctanh( (x-1)/(x+1) )
        around 0, arctan() is almost linear with slope 1
    *)
  CONST
    c1 = 1.4142135;  (* sqrt(2) *)
    c2 = 0.6931472;  (* ln(2) *)
    c3 = 0.89554059;
    c4 = 1.82984424;
    c5 = 1.65677798;
  VAR e: INTEGER;
  BEGIN
    ASSERT(x > 0.0); UNPK(x, e);              (* x in 1 .. 2 *)
    IF x > c1 THEN x := x*0.5; INC(e) END;    (* x in 0.7 .. 1.4*)
    x := (x - 1.0)/(x + 1.0);                 (* x in -0.17 .. 0.17 *)
    x := FLT(e)*c2 + x*(c3 + c4/(c5 - x*x))
  RETURN x END ln;
 
END Log.
